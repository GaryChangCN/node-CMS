!function(){var e={bindEvent:function(){var e=this,o='<div class="love-mask" style="width:100%;height:100%;position:fixed;z-index:250;left:0;top:0;background: #000 !important;opacity: 0.7 !important;"></div>';$("body").on("blur","input.search",function(){var e=$(this).val(),o=~window.location.href.indexOf("language=en")?"&language=en":"";return!!e&&void(window.location=window.location.origin+"/search.html?keywords="+e+o)}),$("body").on("click",".to-search",function(){var e=$(this).prev("input").val(),o=~window.location.href.indexOf("language=en")?"&language=en":"";return!!e&&void(window.location=window.location.origin+"/search.html?keywords="+e+o)}),$("body").on("focus","input.search",function(){var e=this;$(document).keyup(function(o){var t=o.which;if(13==t){var i=$(e).val(),n=~window.location.href.indexOf("language=en")?"&language=en":"";if(!i)return!1;window.location=window.location.origin+"/search.html?keywords="+i+n}})}),$("body").on("click",".star",function(){console.log($(this));$(this).parents(".card-item").data("id");"star-on"===$(this).attr("id")?($(this).parent().children("#star-on").addClass("star-hide"),$(this).parent().children("#star-off").removeClass("star-hide"),e.ProductToQuote($(this).data("id"),"del")):($(this).parent().children("#star-off").addClass("star-hide"),$(this).parent().children("#star-on").removeClass("star-hide"),e.ProductToQuote($(this).data("id"),"add"))}),$("body").on("click",".choose-combo",function(){var o=$(this).attr("combo"),t=$(this).data("name")?$(this).data("name"):"BEST CHOOSE",i=$(this).data("english")?$(this).data("english"):"BEST CHOOSE",n=$(this).parent().parent(".card-item").find(".item-title"),a=[];n.each(function(){a.push($(this).data("id"))});var c={combo:o,name:t,englishName:i,product:a};e.comboToQuote(c,"add")}),$("body").on("click",".delete-product",function(){var o=$(this).data("id");e.ProductToQuote(o,"del")}),$("body").on("click",".delete-combo",function(){var o=$(this).attr("combo"),t={combo:o};e.comboToQuote(t,"del")}),$("body").on("click",".remove-all",function(){e.removeAll()}),$("img").error(function(){$(this).attr("src","http://ohnpdrepj.bkt.clouddn.com/%E9%BB%98%E8%AE%A4%E5%8A%A0%E8%BD%BD%E9%94%99%E8%AF%AF.png")}),$(".love-remove-all").click(function(){e.removeAll()}),$(".product").mouseover(function(){$(".slide-down").css("bottom","-225px")}).mouseout(function(){$(".slide-down").css("bottom","10px")}),$(".slide-down").mouseout(function(){$(this).css("bottom","10px")}).mouseover(function(){$(".slide-down").css("bottom","-225px")}).children().mouseover(function(){$(".slide-down").css("bottom","-225px")}),$(".open-slide-down").click(function(){var e=$(window).height()-$("slide-down").height()-65;$(".mobile-navbar-cover").css("height",e+"px"),$(".slide-down").slideDown("fast",function(){setTimeout(function(){$(".open-slide-down").hide(),$(".open-slide-up").show()},100)})}),$(".open-slide-up,.mobile-navbar-cover").click(function(){$(".mobile-navbar-cover").css("height","0"),$(".open-mobile-search").show().next().hide(),$(".slide-down").slideUp("fast",function(){setTimeout(function(){$(".open-slide-down").show(),$(".open-slide-up").hide()},100)})}),$(".product").click(function(){$(".product-slide-down").not($(this).next()).slideUp(),$(this).next(".product-slide-down").slideToggle()}),$(".open-mobile-search").click(function(){$(this).hide().next().show().children("input").focus()}),$(".select-language").click(function(e){var o=window.location.href;return!$(this).hasClass("select")&&("cn"===$(this).data("language")?o=~o.indexOf("?language=en")?"?language=en"===window.location.search?o.replace("?language=en",""):o.replace("?language=en","?"):o.replace("&language=en",""):o+=~o.indexOf("?")?"&language=en":"?language=en",void(window.location=o))});var t={open:function(){$(".pc-love").addClass("select"),$(".love-container").css("right","0px"),$("body").append(o)},close:function(){$(".love-container").css("right","-340px"),$(".pc-love").removeClass("select"),$(".love-mask").remove()}};$(".pc-love").click(function(){var e=$(".love-container");"0px"===e.css("right")?t.close():t.open()}),$(".close-love").click(function(){t.close()}),$("body").on("click",".love-mask",function(){t.close()})},delStar:function(e){if(/(search)|(equip-product)|(part-product)/i.test(window.location.href)){var o=$(".star");e?o.each(function(){$(this).data("id")===e&&($(this).parent().children("#star-on").addClass("star-hide"),$(this).parent().children("#star-off").removeClass("star-hide"))}):o.each(function(){$(this).parent().children("#star-on").addClass("star-hide"),$(this).parent().children("#star-off").removeClass("star-hide")})}},ProductToQuote:function(e,o){var t=this,i=JSON.parse(localStorage.getItem("quote"));if(i)if("add"===o){if(~i.product.indexOf(e))return void alert("你已经把它添加到询单啦！");i.product.push(e),t.setQuoteStage(i),t.updateProductTemplate(e,o)}else{if(!~i.product.indexOf(e))return;i.product.splice(i.product.indexOf(e),1),t.setQuoteStage(i),t.updateProductTemplate(e,o)}else t.setQuoteStage(),t.ProductToQuote(e,o)},updateProductTemplate:function(e,o){var t=this;if("del"===o)~window.location.href.indexOf("quote.html")?($("#quote-list").find(".product-item[product="+e+"]").remove(),$("#nav-list").find("li[product="+e+"]").remove()):$("#nav-list").find("li[product="+e+"]").remove(),t.delStar(e);else{var i=[e];$.post("/api/product/arr",{arr:JSON.stringify(i)},function(e){var o=e;o.chinese=!~window.location.search.indexOf("language=en");var t=template("nav-quote-product",o);if($("#nav-list").append(t),~window.location.href.indexOf("quote.html")){var i=template("quote-product",o);$("#quote-list").append(i)}})}},comboToQuote:function(e,o){var t=this,i=JSON.parse(localStorage.getItem("quote"));if(i)if("add"===o){for(var n=!1,a=0;a<i.combo.length;a++)i.combo[a].combo===e.combo&&(n=!0);if(n)return void alert("你已经把它添加到询单啦！");i.combo.push(e),t.setQuoteStage(i),t.updateComboTemplate(e,o)}else{for(var a=0;a<i.combo.length;a++)if(i.combo[a].combo===e.combo)var c=a;if(!~c)return;i.combo.splice(c,1),t.setQuoteStage(i),t.updateComboTemplate(e,o)}else t.setQuoteStage(),t.comboToQuote(e,o)},updateComboTemplate:function(e,o){if("del"===o)~window.location.href.indexOf("quote.html")?($("#quote-list").find(".product-item[combo='"+e.combo+"']").remove(),$("#nav-list").find("li[combo='"+e.combo+"']").remove()):$("#nav-list").find("li[combo='"+e.combo+"']").remove();else{var t=[e],i={list:t,chinese:!~window.location.search.indexOf("language=en")},n=template("nav-quote-combo",i);if($("#nav-list").append(n),~window.location.href.indexOf("quote.html")){var a=template("quote-combo",i);$("#quote-list").append(a)}}},removeAll:function(){var e=JSON.parse(localStorage.getItem("quote"));e.product=[],e.combo=[],~window.location.href.indexOf("quote.html")?($("#quote-list").empty(),$("#nav-list").empty()):$("#nav-list").empty(),this.setQuoteStage(e),this.delStar()},setQuoteTemplate:function(){var e=JSON.parse(localStorage.getItem("quote"));if(e.combo.length>0){var o={list:e.combo,chinese:!~window.location.search.indexOf("language=en")},t=template("nav-quote-combo",o);if($("#nav-list").append(t),~window.location.href.indexOf("quote.html")){var i=template("quote-combo",o);$("#quote-list").append(i)}}e.product.length>0&&$.post("/api/product/arr",{arr:JSON.stringify(e.product)},function(e){var o=e;o.chinese=!~window.location.search.indexOf("language=en");var t=template("nav-quote-product",o);if($("#nav-list").append(t),~window.location.href.indexOf("quote.html")){var i=template("quote-product",o);$("#quote-list").append(i)}})},setQuoteStage:function(e){var o=JSON.parse(localStorage.getItem("quote")),t=this;if(o&&o.createTime)if(e)e.updateTime=new Date,localStorage.setItem("quote",JSON.stringify(e));else{if(o.combo.length>0){for(var i=[],n=0;n<o.combo.length;n++)o.combo[n].combo&&i.push(o.combo[n]);o.combo=i,t.setQuoteStage(o)}var a=o.updateTime||o.createTime;if(new Date-new Date(a)<o.timeValuation)return}else{var c={product:e&&e.product?e.product:[],combo:e&&e.combo?e.combo:[],createTime:new Date,updateTime:new Date,timeValuation:94608e6};localStorage.setItem("quote",JSON.stringify(c))}},init:function(){var e=this;FastClick.attach(document.body),template.config("openTag","<%"),template.config("closeTag","%>"),e.bindEvent(),e.setQuoteStage(),e.setQuoteTemplate()}};e.init()}();